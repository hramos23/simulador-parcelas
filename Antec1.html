
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Simulador de Parcelas com Desconto</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial; margin: 30px; }
    label, input { display: block; margin: 10px 0; }
    input[type="number"] { width: 200px; }
    button { margin: 10px 5px 0 0; }
    .resultado { margin-top: 30px; padding: 10px; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h2>Simulador de Parcelas com Desconto Sucessivo</h2>
  
  <label>Quantidade de Parcelas:</label>
  <input type="number" id="qtdParcelas" min="1" value="3">

  <label>Porcentagem de Desconto (%):</label>
  <input type="number" id="porcentagem" min="0" step="0.01" value="10">

  <label>Valor da Parcela (R$):</label>
  <input type="number" id="valorParcela" min="0" step="0.01" value="100">

  <label>Valor de Desconto Inicial (R$):</label>
  <input type="number" id="valorDesc" min="0" step="0.01" value="0">

  <button onclick="calcular()">Calcular</button>
  <button onclick="window.print()">Imprimir</button>
  <button onclick="exportarExcel()">Exportar Excel</button>

  <div class="resultado" id="resultado"></div>

  <script>
    let parcelasDetalhes = [];

    function calcular() {
      let qtdParcelas = parseInt(document.getElementById("qtdParcelas").value);
      let porcentagem = parseFloat(document.getElementById("porcentagem").value);
      let valorParcela = parseFloat(document.getElementById("valorParcela").value);
      let valorDesc = parseFloat(document.getElementById("valorDesc").value);

      let totalSemDesconto = qtdParcelas * valorParcela;
      let remanescente = valorParcela;
      parcelasDetalhes = [];

      let detalhes = `<strong>Valor Total sem Desconto:</strong> R$ ${totalSemDesconto.toFixed(2)}<br><br>`;
      detalhes += `<strong>Processo de Descontos Sucessivos:</strong><br>`;

      for (let i = 0; i < qtdParcelas; i++) {
        remanescente = remanescente - (remanescente * (porcentagem / 100));
        valorDesc += remanescente;
        detalhes += `Parcela ${i + 1}: R$ ${remanescente.toFixed(2)}<br>`;
        parcelasDetalhes.push({ Parcela: i + 1, Valor: remanescente.toFixed(2) });
      }

      detalhes += `<br><strong>Valor Total com Descontos Sucessivos:</strong> R$ ${valorDesc.toFixed(2)}`;

      document.getElementById("resultado").innerHTML = detalhes;
    }

    function exportarExcel() {
      if (parcelasDetalhes.length === 0) {
        alert("Calcule primeiro antes de exportar.");
        return;
      }

      const wb = XLSX.utils.book_new();
      const ws_data = [["Parcela", "Valor (R$)"], ...parcelasDetalhes.map(p => [p.Parcela, p.Valor])];
      const ws = XLSX.utils.aoa_to_sheet(ws_data);
      XLSX.utils.book_append_sheet(wb, ws, "Parcelas");

      XLSX.writeFile(wb, "parcelas_desconto.xlsx");
    }
  </script>
</body>
</html>
