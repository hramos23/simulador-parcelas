
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Simulador de Parcelas com Desconto</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f0f2f5;
      padding: 40px;
    }
    .container {
      background-color: #fff;
      max-width: 700px;
      margin: auto;
      padding: 30px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      border-radius: 10px;
    }
    h2 {
      text-align: center;
      color: #333;
      margin-bottom: 30px;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 15px;
    }
    input[type="number"] {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
    }
    .buttons {
      margin-top: 25px;
      text-align: center;
    }
    button {
      padding: 10px 20px;
      margin: 0 10px 10px 0;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      background-color: #4CAF50;
      color: white;
    }
    button:hover {
      background-color: #45a049;
    }
    .resultado {
      margin-top: 30px;
      padding: 20px;
      background-color: #fafafa;
      border: 1px solid #ccc;
      border-radius: 5px;
      line-height: 1.6;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Simulador de Parcelas com Desconto Sucessivo</h2>

    <label for="qtdParcelas">Quantidade de Parcelas:</label>
    <input type="number" id="qtdParcelas" min="1" value="3">

    <label for="porcentagem">Porcentagem de Desconto (%):</label>
    <input type="number" id="porcentagem" min="0" step="0.01" value="10">

    <label for="valorParcela">Valor da Parcela (R$):</label>
    <input type="number" id="valorParcela" min="0" step="0.01" value="100">

    <div class="buttons">
      <button onclick="calcular()">Calcular</button>
      <button onclick="limpar()">Limpar</button>
      <button onclick="window.print()">Imprimir</button>
      <button onclick="exportarExcel()">Exportar Excel</button>
    </div>

    <div class="resultado" id="resultado"></div>
  </div>

  <script>
    let parcelasDetalhes = [];

    function calcular() {
      let qtdParcelas = parseInt(document.getElementById("qtdParcelas").value);
      let porcentagem = parseFloat(document.getElementById("porcentagem").value);
      let valorParcela = parseFloat(document.getElementById("valorParcela").value);

      let totalSemDesconto = qtdParcelas * valorParcela;
      let remanescente = valorParcela;
      let valorDesc = 0;
      parcelasDetalhes = [];

      let detalhes = `<strong>Valor Total sem Desconto:</strong> R$ ${totalSemDesconto.toFixed(2)}<br><br>`;
      detalhes += `<strong>Processo de Descontos Sucessivos:</strong><br>`;

      for (let i = 0; i < qtdParcelas; i++) {
        remanescente = remanescente - (remanescente * (porcentagem / 100));
        valorDesc += remanescente;
        detalhes += `Parcela ${i + 1}: R$ ${remanescente.toFixed(2)}<br>`;
        parcelasDetalhes.push({ Parcela: i + 1, Valor: remanescente.toFixed(2) });
      }

      detalhes += `<br><strong>Valor Total com Descontos Sucessivos:</strong> R$ ${valorDesc.toFixed(2)}`;
      document.getElementById("resultado").innerHTML = detalhes;
    }

    function limpar() {
      document.getElementById("qtdParcelas").value = "";
      document.getElementById("porcentagem").value = "";
      document.getElementById("valorParcela").value = "";
      document.getElementById("resultado").innerHTML = "";
      parcelasDetalhes = [];
    }

    function exportarExcel() {
      if (parcelasDetalhes.length === 0) {
        alert("Calcule primeiro antes de exportar.");
        return;
      }

      const wb = XLSX.utils.book_new();
      const ws_data = [["Parcela", "Valor (R$)"], ...parcelasDetalhes.map(p => [p.Parcela, p.Valor])];
      const ws = XLSX.utils.aoa_to_sheet(ws_data);
      XLSX.utils.book_append_sheet(wb, ws, "Parcelas");

      XLSX.writeFile(wb, "parcelas_desconto.xlsx");
    }
  </script>
</body>
</html>
